[build]
  command = "NITRO_PRESET=netlify npm run build"
  publish = ".output/public"

[functions]
  directory = ".netlify/functions-internal"
  node_bundler = "esbuild"

# ───────── Bot / scanner blocks (specific rules first) ─────────

# Block file-extension probes (.php, .asp, archives, dumps, etc.)
[[redirects]]
  from = "/*.{php,asp,aspx,cgi,pl,sh,zip,tar,gz,rar,7z,sql,bak,old,env}"
  to = "/404.html"
  status = 404
  force = true

# Common WordPress probes (expand as you like)
[[redirects]]
  from = "/wp-*"
  to = "/404.html"
  status = 404
  force = true

[[redirects]]
  from = "/wp-admin/*"
  to = "/404.html"
  status = 404
  force = true

[[redirects]]
  from = "/wp-login.php"
  to = "/404.html"
  status = 404
  force = true

# ───────── Nuxt/Nitro SSR & API fallback  ─────────

# Let Nitro handle ALL remaining routes (SSR pages + /api/*),
# while still allowing existing files in .output/public to be served directly.

[[redirects]]
  from = "/*"
  to = "/.netlify/functions/server"
  status = 200
